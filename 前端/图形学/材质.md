
## 漫反射材质

漫反射材质对各个方向都均匀反射光线，所以 `BRDF` 是常数。
由于不自发光，出射的 radiance = $f_{r}(p,w_{i}\to w_{r}) radiance_{i}\cos \theta\,dw$ 的积分，这里假设任意一个方向的入射光是相同的，即 $radiance_{i}$ 是常数而且不考虑材质对光的吸收，那么 radiance = f * radiance * $\pi$  则可得 f = $\displaystyle \frac{1}\pi$ ，引入反射率 $\rho$ 的概念，可以是一个 0 到 1 的数字也可以是一个三通道 0 到 1 的数组。 则 f = $\displaystyle \frac{\rho}{\pi}$


### 反射的表述

- 法线是入射和反射光的角平分线
- 以法线作为 z 轴建左手系，入射和反射光线与 x 轴正方向的夹角刚好相差 $\pi$ ，即入射方位角与反射方位角的关系是： $\phi_{i}=(\phi_{o}+\pi ) \,mod\,(2\pi)$  方位角表示以法线为旋转轴的旋转角

## fresnel term 

### 绝缘体

斜入射则多为反射，垂直入射（即平行法线）则多为折射

### 导体

无论如何都多为反射

### 精确计算公式

假设入射面折射率 $n_{1}$ 入射角 $\theta_{i}$ ，折射面折射率 $n_{2}$ 折射角 $\theta_{t}$ ，考虑光的 s、p 方向极化则
反射比例 $R_{s} = |\displaystyle \frac{n_{1}\cos \theta_{i}-n_{2}\cos \theta_{t}}{n_{1}\cos \theta_{i}+n_{2}\cos \theta_{t}}|^2$ ， $R_{p}=|\displaystyle \frac{n_{1}\cos \theta_{t}-n_{2}\cos \theta_{i}}{n_{1}\cos \theta_{t}+n_{2}\cos \theta_{i}}|^{2}$ ，考虑简化模型，最终的反射比例直接用 $R_{s}$ 和 $R_{P}$ 的均值

### 估计算法

记入射光线和平面夹角为 $\theta$ ，那么反射比例可以表示成一个从 $R_{0}=\left( \displaystyle \frac{n_{1}-n_{2}}{n_{1}+n_{2}} \right)^{2}$ 增到 1 的函数
即 $R(\theta) = R_{0} + (1-R_{0})(1-\cos \theta)^{5}$

## 微表面理论

物体的表面是粗糙的，靠近看可以看到具体的一个个凹凸不平的微表面，离远了则看到几乎是个粗糙的平面，每单个微表面进行完全的镜面反射。微表面模型求反射光时，需要考虑 fresnel term 以及自遮挡和半程向量

### 自遮挡

如果光线几乎平行于平面照射，那么容易被凹凸不平的微表面遮挡

### 半程向量

每个微表面都做完全的镜面反射，所以只有法线完全等于入射和反射的半程方向向量时才考虑这个微表面的贡献

### 各向异性

- 微表面各个具有方向性，从不同的方向遍历表面会有明显不同
- BRDF 会随着方位角的旋转变换，保持入射和出射的相对角度不变，以法线为旋转轴旋转后得到的 BRDF 不同