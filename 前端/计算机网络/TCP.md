# TCP

tcp面向字节流，所有数据都要带上序列号和确认号

### 三次握手

首先由客户端发送SYN报文段，其SYN比特设置为1。然后服务端为连接分配资源，发送SYNACK报文段，其SYN比特设置为1，前面这两次都是不发实际数据的。而最后一次是由客户端向服务端发送，此时客户端为连接分配资源，这时候连接已经建立了，其SYN比特设置为0。建立连接后客户端和服务端互相发送数据的时候SYN都是0。

#### 两次握手的弊端

如果SYN报文段因为网络延迟而迟迟没有送达，客户端判定它已经丢失，重新建立了一个TCP连接，在这个连接关闭后，前面的SYN报文段送达，服务端认定其为新的连接并分配了资源。 如果是三次握手，那么第三次客户端会发送RST包来终止这个无效的连接



### 四次挥手

第一次挥手客户端发送，第二次是服务端 ACK，第二和第三次之间服务器把剩余数据发出去，服务器第三次挥手，客户端第四次挥手