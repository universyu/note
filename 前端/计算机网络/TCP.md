# TCP

### 三次握手

首先由客户端发送SYN报文段，其SYN比特设置为1。然后服务端为连接分配资源，发送SYNACK报文段，其SYN比特设置为1，前面这两次都是不发实际数据的。而最后一次是由客户端向服务端发送，此时客户端为连接分配资源，这时候连接已经建立了，其SYN比特设置为0。建立连接后客户端和服务端互相发送数据的时候SYN都是0。

#### 两次握手的弊端

如果SYN报文段因为网络延迟而迟迟没有送达，客户端判定它已经丢失，重新建立了一个TCP连接，在这个连接关闭后，前面的SYN报文段送达，服务端认定其为新的连接并分配了资源。 如果是三次握手，那么第三次客户端会发送RST包来终止这个无效的连接



### 四次挥手

首先由客户端发送特殊的TCP报文段，其FIN为1，然后由客户端ACK，然后客户端发送特殊TCP报文段，其FIN为1，客户端发送ACK，并进入TIME_WAIT状态以在最后的ACK丢包后可以重传，服务端收到ACK立马清空资源，客户端TIME_WAIT后也会清空资源